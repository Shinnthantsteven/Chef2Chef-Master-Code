<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef2Chef | Master System</title>
    
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --brand: #10b981; --dark: #0f172a; --bg: #f1f5f9; --text: #334155; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow: hidden; }
        
        /* Login Screen */
        #loginOverlay { position: fixed; inset: 0; background: #0f172a; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-card { background: white; padding: 40px; border-radius: 24px; text-align: center; width: 320px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5); }
        .login-card h2 { letter-spacing: -1px; margin-bottom: 20px; }
        input { width: 100%; padding: 14px; margin-bottom: 12px; border: 2px solid #f1f5f9; border-radius: 12px; box-sizing: border-box; font-family: inherit; font-size: 16px; }
        
        /* Main Layout */
        #mainApp { display: none; height: 100vh; flex-direction: column; }
        .header { background: var(--dark); color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .search-area { padding: 20px 30px; background: white; border-bottom: 1px solid #e2e8f0; }
        #searchIn { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #f1f5f9; font-size: 16px; font-family: inherit; }
        
        /* Table Styling */
        .table-wrap { flex: 1; overflow: auto; padding: 0 30px; background: white; }
        table { width: 100%; border-collapse: collapse; min-width: 1400px; }
        th { position: sticky; top: 0; background: white; padding: 15px 10px; text-align: left; font-size: 10px; font-weight: 800; color: #94a3b8; border-bottom: 2px solid #f1f5f9; text-transform: uppercase; z-index: 10; }
        td { padding: 12px 10px; border-bottom: 1px solid #f1f5f9; font-size: 13px; cursor: pointer; }
        tr:hover td { background: rgba(16, 185, 129, 0.05); }
        
        /* Footer */
        .footer { padding: 10px 30px; background: white; border-top: 1px solid #e2e8f0; font-size: 12px; display: flex; justify-content: space-between; font-weight: 600; }
        .copy-flash { background: #bbf7d0 !important; transition: 0.2s; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-card">
        <h2>CHEF2CHEF</h2>
        <input type="text" id="userInput" placeholder="User Name">
        <input type="password" id="passInput" placeholder="Password">
        <button onclick="doLogin()" style="width:100%; padding:15px; background:var(--brand); color:white; border:none; border-radius:12px; font-weight:800; cursor:pointer; font-size: 16px;">ENTER SYSTEM</button>
    </div>
</div>

<div id="mainApp">
    <div class="header">
        <h1 style="margin:0; font-size:18px; letter-spacing:1px;">CHEF2CHEF <span style="color:var(--brand)">MASTER</span></h1>
        <button onclick="location.reload()" style="background:#ef4444; color:white; border:none; padding:8px 15px; border-radius:8px; font-weight:800; cursor:pointer;">LOGOUT</button>
    </div>
    
    <div class="search-area">
        <input type="text" id="searchIn" placeholder="Search 13,343 items by ID, Name, Supplier or Packing...">
    </div>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Item ID</th>
                    <th style="width:350px">Description</th>
                    <th>Cost</th>
                    <th>U/M</th>
                    <th>Packing</th>
                    <th>Supplier</th>
                    <th>Brand/Origin</th>
                    <th>Category</th>
                    <th>State</th>
                </tr>
            </thead>
            <tbody id="list">
                <tr><td colspan="9" style="text-align:center; padding:100px; color:#94a3b8;">Loading Database...</td></tr>
            </tbody>
        </table>
    </div>

    <div class="footer">
        <span id="itemCount">Connecting...</span>
        <span style="color:var(--brand)">‚óè Database Encrypted & Live</span>
    </div>
</div>

<script>
    let inventory = [];

    function doLogin() {
        const user = document.getElementById('userInput').value.toUpperCase();
        const pass = document.getElementById('passInput').value;
        if(["STEVE", "FATIMA", "ASWAN", "JOBY"].includes(user) && pass === "C2C2026") {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            loadInventory();
        } else {
            alert("Access Denied: Invalid Credentials");
        }
    }

    async function loadInventory() {
        const countDisplay = document.getElementById('itemCount');
        try {
            // Fetch as text to prevent GitHub from blocking the file download
            const res = await fetch('data.csv?cache=' + Date.now());
            if(!res.ok) throw new Error("CSV file not found");
            
            const text = await res.text();
            const wb = XLSX.read(text, { type: 'string' });
            const sheet = wb.Sheets[wb.SheetNames[0]];
            const raw = XLSX.utils.sheet_to_json(sheet, { defval: "" });
            
            inventory = raw.map(r => ({
                id: String(r['Item'] || r['Item ID'] || ""),
                desc: String(r['Description'] || ""),
                // AUTO-REMOVE 'AED' as requested
                cost: String(r['Cost'] || r['Price'] || "0").toLowerCase().replace('aed', '').trim(),
                um: String(r['U/M'] || ""),
                pack: String(r['Case Packing'] || r['Case Pack'] || ""),
                sup: String(r['Preferred Supplier'] || ""),
                brand: (r['Brand'] || "") + " / " + (r['Origin'] || ""),
                cat: String(r['Cat 2'] || ""),
                state: String(r['State'] || "")
            }));

            showData(inventory);
        } catch (err) {
            countDisplay.innerText = "CRITICAL ERROR: data.csv file missing from folder.";
            console.error(err);
        }
    }

    function showData(data) {
        const tbody = document.getElementById('list');
        // Only render 150 rows for speed, but search will check all 13,000+
        const limited = data.slice(0, 150);
        
        tbody.innerHTML = limited.map(item => `
            <tr>
                <td onclick="copyText('${item.id}', this)">${item.id}</td>
                <td onclick="copyText('${item.desc}', this)"><strong>${item.desc}</strong></td>
                <td style="color:var(--brand); font-weight:800">${item.cost}</td>
                <td>${item.um}</td>
                <td>${item.pack}</td>
                <td>${item.sup}</td>
                <td>${item.brand}</td>
                <td>${item.cat}</td>
                <td>${item.state}</td>
            </tr>
        `).join('');
        
        document.getElementById('itemCount').innerText = data.length + " Items Synchronized";
    }

    document.getElementById('searchIn').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const results = inventory.filter(i => 
            (i.id + i.desc + i.sup + i.brand + i.pack).toLowerCase().includes(term)
        );
        showData(results);
    });

    function copyText(text, el) {
        navigator.clipboard.writeText(text);
        el.classList.add('copy-flash');
        setTimeout(() => el.classList.remove('copy-flash'), 200);
    }
</script>
</body>
</html>
